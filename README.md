# TIHA v6.0: Canonical Framework (EEG vs. PNS Comparative Validation)

This repository contains the publication code and final validation analysis (v6.0) for the **Hybrid Affective Integration Theory (TIHA)**.

This work validates the **Idiosyncratic Linear Model (MLI)** as a robust framework, not only for EEG (CNS) but also for peripheral signals (PNS, wearables). We conducted a "model competition" on the DEAP dataset to compare the two application paths:

1. **EEG Model (v5.1:** $\Phi, E, S_{eeg}$**):** $R^2=0.1810$ ($p < 1.7\text{e-}11$).
2. **PNS Model (v6.0 "TIHA-Lite":** $HRV, EDA, S_{gsr}$**):** $R^2=0.0914$ ($p < 4.9\text{e-}11$).
    

Both models are **methodologically robust** (Max VIF < 2.74) and **statistically significant**. The v5.1 EEG model also formally proves the **Idiosyncratic Paradox** (non-universal weights, $p > 0.104$).

The **"TIHA-Lite" (Phase III) pivot is validated and viable**, proving that wearable signals alone can explain 9.1% of affective valence.

## üìä Key Results (v5.1 EEG Model)

Here is the visual output from the `TIHA_v5.1_Publication_Paradox.py` analysis script, confirming the R-squared distribution (mean=0.181) and the primary force of the $\Phi$ (Integration) proxy.

<!-- This image is generated by running the v5.1 analysis script. It should be committed to the repository. -->

This analysis proves the v5.1 model is predictive (p < 1.7e-11) and robust (VIF < 2.74).

## üî¨ The Scientific Journey: From v3.5 Failure to v6.0 Validation

This result is the product of a rigorous falsification process, documented in the (Portuguese) `RESEARCH_LOG_TIHA.md`:

1. **v3.5 (Failure 1):** The universal `Operator ‚äô` failed the LOSO (generalization) test.
2. **v4.7 (Failure 2):** The 4-component model ($R^2 \approx 0.229$) **FAILED** the robustness test (Max VIF $\approx 6.96$).
3. **v4.8 (Solution):** A "Model Competition" proved the [$\Phi, E, S$] model was the robust winner ($R^2=0.182$, VIF < 5).
4. **v5.1 (EEG Proof):** The [$\Phi, E, S$] model was validated with Ridge and **formally PROVED the "Idiosyncratic Paradox"** ($p > 0.104$).
5. **v6.0 (PNS Proof):** The `v6.0` script ran the "Comparative Validation," proving the **"TIHA-Lite" pivot is viable** ($R^2=0.091$).
    

## üöÄ How to Use This Repository

This repository is organized for two primary audiences: **Researchers** (who wish to replicate the paper) and **Developers** (who wish to build on the framework).

### 1. For Researchers (Replicating the v6.0 Paper)

To exactly replicate the results published in `TIHA_v6.0_Paper.pdf` and the `.json` files, you should use the canonical scripts located in the `analysis_pipeline/` folder.

1. **Download DEAP** (see "Data Setup" instructions below).
2. **Run the EEG Validation Script (v5.1):**
    ```
    python analysis_pipeline/TIHA_v5.1_Publication_Paradox.py
    ```
    _(This will replicate the `TIHA_v5.1_results.json` and `TIHA_v5.1_plots.png`)_
3. **Run the Comparative Validation Script (v6.0):**
    ```
    python analysis_pipeline/TIHA_v6.0_Comparative_Validation.py
    ```
    _(This will replicate the `TIHA_v6.0_results.json`)_
    

### 2. For Developers (Building Phase II/III)

To build an application (Phase II or III), **do not** use the monolithic analysis scripts. Instead, import the clean function library:

`tiha_core.py`

This library contains all the validated proxy functions (e.g., `calculate_phi_alpha`, `calculate_hrv_rmssd`) ready for use.

**See the examples in the `examples/` folder:**

- `examples/demo_eeg.py`: Shows how to calculate EEG proxies (Phase II) in real-time.
- `examples/demo_snp.py`: Shows how to calculate wearable proxies (Phase III) in real-time.
    

## üìÅ File Structure and Data Setup

### 1. Environment

Clone this repository and install the dependencies:

```
git clone [https://github.com/leandroantoniodasilvapacheco/TIHA-MLI-v6.0.git](https://github.com/leandroantoniodasilvapacheco/TIHA-MLI-v6.0.git)
cd TIHA-MLI-v6.0
pip install -r requirements.txt
```

_(The `requirements.txt` contains: `numpy`, `pandas`, `scipy`, `scikit-learn`, `matplotlib`, `statsmodels`)_


### 2. Data Setup (Important!)

The DEAP dataset is **NOT INCLUDED** in this repository. You must download it from the official source.

1. **Download:** Download `data_preprocessed_python.zip` from: [http://www.eecs.qmul.ac.uk/mmv/datasets/deap/](http://www.eecs.qmul.ac.uk/mmv/datasets/deap/ "null")
2. **Structure:** Create a directory named `deap_data` in the root of this project. 
3. **Unzip:** Unzip the contents of the `.zip` file into `deap_data`.
    

The final folder structure _must_ be:

```
TIHA-MLI-v6.0/
‚îú‚îÄ‚îÄ deap_data/
‚îÇ   ‚îî‚îÄ‚îÄ data_preprocessed_python/
‚îÇ       ‚îú‚îÄ‚îÄ s01.dat
‚îÇ       ‚îî‚îÄ‚îÄ ... (s32.dat)
‚îÇ
‚îú‚îÄ‚îÄ analysis_pipeline/      <-- (For Researchers: Replicate)
‚îÇ   ‚îú‚îÄ‚îÄ TIHA_v5.1_Publication_Paradox.py
‚îÇ   ‚îî‚îÄ‚îÄ TIHA_v6.0_Comparative_Validation.py
‚îÇ
‚îú‚îÄ‚îÄ tiha_core.py            <-- (For Developers: Build)
‚îÇ
‚îú‚îÄ‚îÄ examples/               <-- (For Developers: Learn)
‚îÇ   ‚îú‚îÄ‚îÄ demo_eeg.py
‚îÇ   ‚îî‚îÄ‚îÄ demo_snp.py
‚îÇ
‚îú‚îÄ‚îÄ data_results/           <-- (The Evidence / Results)
‚îÇ   ‚îú‚îÄ‚îÄ TIHA_v5.1_results.json
‚îÇ   ‚îî‚îÄ‚îÄ TIHA_v6.0_results.json
‚îÇ
‚îú‚îÄ‚îÄ README.md               # (This file)
‚îú‚îÄ‚îÄ MANIFEST.MD             # (The Philosophy)
‚îú‚îÄ‚îÄ Manual.md               # (The Open Invitation)
‚îú‚îÄ‚îÄ TIHA_v6.0_Paper.pdf     # (The Scientific Paper)
‚îú‚îÄ‚îÄ TIHA_v5.1_plots.png     # (The Result Plot)
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ LICENSE
```

### 3. Replication Options

**Option A (Recommended): Google Colab**

1. Open `TIHA_v6.0_Colab.ipynb` in Google Colab. (You will need to create this notebook from the cells I provided).
2. The first cell of the notebook will **automatically download and unzip** the DEAP data for you.
3. Run all cells. The comparative results (R¬≤ EEG=0.1810 vs R¬≤ PNS=0.0914) will be generated at the end.
    

**Option B (Local):** If you configured the data manually (Step 2), you can run the Python scripts:

```
# To run the main v6.0 validation
python analysis_pipeline/TIHA_v6.0_Comparative_Validation.py
```

The script will load local data, run the comparative analysis, and save `TIHA_v6.0_results.json`.


## üìú License

This project is licensed under the **MIT License**. The DEAP dataset has its own license and is not covered by this repository.


## üéì How to Cite

If you use this work, please cite the main paper (v6.0), which is pre-registered at this OSF project:

> Pacheco, L. A. da S. (2025). _TIHA v6.0: A Comparative Validation of Idiosyncratic Linear Models (MLI) for Affective Valence (EEG vs. Peripheral Signals)_. Open Science Framework. Project DOI: [https://doi.org/10.17605/OSF.IO/BJ2TS](https://doi.org/10.17605/OSF.IO/BJ2TS "null")
